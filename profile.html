<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="bootstrap-3.3.7/docs/favicon.ico">

    <title>Profile</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap-3.3.7/dist/css/bootstrap.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="bootstrap-3.3.7/docs/assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/jumbotron.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="bootstrap-3.3.7/docs/assets/js/ie-emulation-modes-warning.js"></script>

    <link href="css/main.css" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="css/photogrid/normalize.css" />
    <link rel="stylesheet" type="text/css" href="css/photogrid/demo.css" />
    <link rel="stylesheet" type="text/css" href="css/photogrid/pater.css" />
    <script>document.documentElement.className = 'js';</script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>

    <nav class="navbar navbar-fixed-top navbar-inverse">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Insert Logo Here</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="feed.html">Home</a></li>
            <li class="active"><a href="profile.html">Profile</a></li>
            <li><a href="archives.html">Archives</a></li>
          </ul>
        </div><!-- /.nav-collapse -->
      </div><!-- /.container -->
    </nav><!-- /.navbar -->

    <!-- Main jumbotron for a primary marketing message or call to action -->
    <div class="giant-container">
      <div class="cover-container">
        <div class="cover-photo">
            <img id="cover" src="photos/cover.jpg"/>
            <div class="profile-container">
              <div class="profile-details">
                <img id="profile-pic" src="photos/icon.jpg"/>
                <div class="profile-text">
                  <p class="profile-name"><span>Julianne Tan (@jdle_)</span></p>
                  <p class="profile-email"><span>julianne.tan1122@gmail.com</span></p>
                  <p class="profile-address"><span>Apt. 556, Kulas Light, Gwenborough City, 92998-3874</span></p> 
                  <p class="profile-website"><span>hildegard.org</span></p>
                  <p class="profile-company"><span>Romaguera-Crona,
                  "Multi-layered client-server neural-net",
                  harness real-time e-markets</span></p>
                </div> 
              </div>

              <div class="profile-navbar">
                <ul class="profile-navbar-nav">
                  <li class="active-profile profile-nav-items" id="posts">Posts</li>
                  <li class="profile-nav-items" id="albums">Albums</a></li>
                  <li class="profile-nav-items" id="location">Location</a></li>
                </ul>
              </div>
            </div>
        </div>
      </div>

      <div class="container">
        <div class="posts-container">
          <div class="posts">
            <div class="post-container">
              <div class="post-title"><span>Hello World, My First Program!</span></div>
              <div class="post-details"><span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras faucibus interdum elementum. Donec placerat augue nec sagittis scelerisque. Nulla maximus nunc in nunc commodo, eu pretium urna gravida. Proin dapibus nibh nibh, non fringilla ante placerat sit amet. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam lectus ipsum, dictum ut mauris imperdiet, pellentesque finibus neque. Nullam bibendum tincidunt sem, sit amet feugiat justo.</span></div>
            </div>

            <div class="post-container">
              <div class="post-title"><span>Hello World, My First Program!</span></div>
              <div class="post-details"><span>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras faucibus interdum elementum. Donec placerat augue nec sagittis scelerisque. Nulla maximus nunc in nunc commodo, eu pretium urna gravida. Proin dapibus nibh nibh, non fringilla ante placerat sit amet. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Aliquam lectus ipsum, dictum ut mauris imperdiet, pellentesque finibus neque. Nullam bibendum tincidunt sem, sit amet feugiat justo.</span></div>
            </div>
          </div>

          <div class="more-posts">
            Load more posts
          </div>
        </div>
        

        <div class="gallery-container">
          <div class = "album-gallery">
            <div id = "ag-container">
              <div id="albums-container" class="grid grid--type-c">
                <div class="grid__sizer"></div>
          
                <div class="grid__item">
                  <a class="grid__link pater">
                    <div class="pater__img" style="background:url(photos/haynaiku_cover.png);"></div>
                    <div class="pater__content">
                      <div class="pater__title" aria-label="fullstory">Haynaiku<br> Elle's Haikus</div>
                    </div>
                  </a>
                </div>      
              </div> 
            </div>
          </div>

          <div class="more-albums">
            Load more albums
          </div>
        </div>

        <div class="location-container">
            <div id="map"></div>
            <script>
              var map;
              function initMap() {
                map = new google.maps.Map(document.getElementById('map'), {
                  center: {lat: -34.397, lng: 150.644},
                  zoom: 8
                });
              }
            </script>
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSwO-iKt8UO1GhjmrtPoXpassX0NTmW60&callback=initMap"
            async defer></script>
        </div>
        

        <hr id="footer-border">

        <script src="js/imagesloaded.pkgd.min.js"></script>
        <script src="js/masonry.pkgd.min.js"></script>
        <script src="js/anime.min.js"></script>
        <script src="js/main.js"></script>
        
        <footer class="footer">
          <p>&copy; Blaise Cruz, Giselle Nodalo, Julianne Tan</p>
        </footer>
      </div> <!-- /container -->
    </div>
    


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="bootstrap-3.3.7/docs/assets/js/vendor/jquery.min.js"><\/script>')</script>
    <script src="bootstrap-3.3.7/docs/dist/js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="bootstrap-3.3.7/docs/assets/js/ie10-viewport-bug-workaround.js"></script>
    

    <script>
            // Globals
            var root = 'https://jsonplaceholder.typicode.com';
            var post_list = new Array();
            var user_data;
            var user_posts = new Array();
            var user_albums = new Array();
            var current_set = 1;
            
            // Functions
            var getUrlParameter = function getUrlParameter(sParam) {
                var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

                for (i = 0; i < sURLVariables.length; i++) {
                    sParameterName = sURLVariables[i].split('=');

                    if (sParameterName[0] === sParam) {
                        return sParameterName[1] === undefined ? true : sParameterName[1];
                    }
                }
            };
            
            // JQuery
            $(document).ready(function() {
                var $loadPostsBtn = $('.more-posts');
                var $loadAlbumsBtn = $('.more-albums');

                $('.gallery-container').hide();
                $('.location-container').hide();
                //$('.post-container').hide();

                $('#albums').click(function() {
                    $('.gallery-container').show();
                    $('.posts-container').hide();
                    $('.location-container').hide();
                    $('#albums').addClass("active-profile");
                    $('#posts').removeClass("active-profile");
                    $('#location').removeClass("active-profile");

                    var container = document.querySelector('#albums-container');
                            var masonry = new Masonry(container, {
                                columnWidth: 10,
                                itemSelector: '.grid__item'
                        });
                });

                $('#posts').click(function() {
                    $('.gallery-container').hide();
                    $('.posts-container').show();
                    $('.location-container').hide();
                    $('#albums').removeClass("active-profile");
                    $('#posts').addClass("active-profile");
                    $('#location').removeClass("active-profile");
                });

                $('#location').click(function() {
                    $('.gallery-container').hide();
                    $('.posts-container').hide();
                    $('.location-container').show();
                    $('#albums').removeClass("active-profile");
                    $('#posts').removeClass("active-profile");
                    $('#location').addClass("active-profile");
                    refreshMap();
                });

                // Variables
                var $feed = $('#feed');
                var $profile = $('#profile');
                var $albums = $('#albums');
                var $loadPostsBtn = $('#loadMorePosts');
                var $loadAlbumsBtn = $('#loadMoreAlbums');
                var user_id = getUrlParameter('id');
                if (user_id != null) {
                    function fetchUserData() {
                        console.log('Fetching user data...');
                        $.getJSON(root + '/users/' + user_id, function(data) {
                            user_data = data;  
                        });
                        console.log('Done!');
                    }
                    
                    function printUserData() {
                        console.log('Printing user data...');
                        var address = user_data.address;
                        $(".posts").empty();
                        $(".profile-text").empty();

                        var address = document.createElement("span");
                        var name = document.createElement("span");
                        var email = document.createElement("span");
                        var phone = document.createElement("span");
                        var website = document.createElement("span");
                        var company = document.createElement("span");


                        $(address).text(address.suite + ', ' + address.street + ', ' + address.city + ', ' + address.zipcode);
                        $(name).text(user_data.name + ' (@' + user_data.username + ')');
                        $(email).text(user_data.email);
                        $(phone).text(user_data.phone);
                        $(website).text(user_data.website);
                        $(company).text(user_data.company.name + ', "' + user_data.company.catchPhrase + '", ' + user_data.company.bs); 

                        var profileName = document.createElement("p");
                        var profileEmail = document.createElement("p");
                        var profileAddress = document.createElement("p");
                        var profileWebsite = document.createElement("p");
                        var profileCompany = document.createElement("p");

                        $(profileName).addClass("profile-name");
                        $(profileEmail).addClass("profile-email");
                        $(profileAddress).addClass("profile-address");
                        $(profileWebsite).addClass("profile-website");
                        $(profileCompany).addClass("profile-company");

                        $(profileName).append(name);
                        $(profileEmail).append(email);
                        $(profileAddress).append(address);
                        $(profileWebsite).append(website);
                        $(profileCompany).append(company);

                        $('.profile-text').append(profileName);
                        $('.profile-text').append(profileEmail);
                        $('.profile-text').append(profileAddress);
                        $('.profile-text').append(profileWebsite);
                        $('.profile-text').append(profileCompany);

                        console.log('Done!');
                    }
                    
                    function fetchUserPosts() {
                        console.log('Getching user posts...');
                        $.getJSON(root + '/posts?userId=' + user_id, function(data) {
                            var i;
                            for (i = 0; i < data.length; i++)
                                user_posts.push(data[i]);
                        });
                        console.log('Done!');
                    }
                    
                    function printPost(post) {
                        var postTitle = document.createElement("div");
                        var postDetails = document.createElement("div");
                        var postContainer = document.createElement("div");
                        var title = document.createElement("span");
                        var details = document.createElement("span");

                        $(postTitle).addClass("post-title");
                        $(postDetails).addClass("post-details");
                        $(postContainer).addClass("post-container");

                        $(title).text(post.title);
                        $(details).text(post.body);

                        $(postTitle).append(title);
                        $(postDetails).append(details);

                        $(postContainer).append(postTitle);
                        $(postContainer).append(postDetails);

                        $('.posts').append(postContainer);
                    }
                    
                    function printPostSequence() {
                        console.log('Printing posts...');
                        $('.posts').empty();

                        if (user_posts.length > 0) {
                            var post = user_posts.pop();
                            console.log(post);
                            printPost(post);
                            post = user_posts.pop();
                            console.log(post);
                            printPost(post);
                            console.log('Done!');
                        }
                        else
                            console.log('No more posts exist!');
                    }
                    
                    function fetchUserAlbums() {
                        console.log('Fetching albums...');
                        $.getJSON(root + '/albums?userId=' + user_id, function(data) {
                            var i;
                            for (i = 0; i < data.length; i++)
                                user_albums.push(data[i]);
                        });
                        console.log('Done!');
                    }
                    
                    function printAlbum(album) {

                        var gridItem = document.createElement("div");
                        var gridLink = document.createElement("a");
                        var paterImg = document.createElement("div");
                        var paterContent = document.createElement("div");
                        var paterTitle = document.createElement("div");

                        $(gridItem).addClass("grid__item");
                        $(gridLink).addClass("grid__link");
                        $(gridLink).addClass("pater");
                        $(paterImg).addClass("pater__img");
                        $(paterContent).addClass("pater__content");
                        $(paterTitle).addClass("pater__title");

                        

                        $.getJSON(root + '/photos?albumId=' + album.id, function(data) {
                            var photo = data[0];
                            $(paterImg).css({'background-image': 'url(' + photo.thumbnailUrl});
                        });

                        gridLink.setAttribute('href', "album.html?albumId=" + album.id);
                        $(paterTitle).append(album.title);

                        $(paterContent).append(paterTitle);
                        $(gridLink).append(paterImg);
                        $(gridLink).append(paterContent);
                        $(gridItem).append(gridLink);

                        $('#albums-container').append(gridItem);

                        /**$('#albums').append('<p><a href="album.html?albumId=' + album.id + '">Title: ' + album.title + '</a></p>');**/
                    }

                    function printMap() {

                        var myOptions = {
                            zoom: 14,
                            center: new google.maps.LatLng(user_data.address.geo.lat, user_data.address.geo.lng)
                        } 
                        map = new google.maps.Map(document.getElementById("map"),
                        myOptions);

                        var center = map.getCenter(); 
                        google.maps.event.trigger(map, 'resize'); 
                        map.setCenter(center); 

                        console.log("lat" + user_data.address.geo.lat);
                        console.log("lng" + user_data.address.geo.lng);
                    }

                    function refreshMap() {
                        var center = map.getCenter(); 
                        google.maps.event.trigger(map, 'resize'); 
                        map.setCenter(center); 
                    }
                    
                    function printAlbumSequence() {
                        console.log('Printing albums...');

                        $('#albums-container').empty();

                        var gridSizer = document.createElement("div");
                        $(gridSizer).addClass("grid__sizer");
                        $('#albums-container').append(gridSizer);

                        if (user_albums.length > 0) {
                            var album = user_albums.pop();
                            console.log(album);
                            printAlbum(album);
                            album = user_albums.pop();
                            console.log(album);
                            printAlbum(album);
                            console.log('Done!');
                        }
                        else
                            console.log('No more albums exist!');

                        var container = document.querySelector('#albums-container');
                        var masonry = new Masonry(container, {
                            columnWidth: '.grid__item',
                            itemSelector: '.grid__item'
                        });
                    }
                    
                    function printAllWithTimeout() {
                        setTimeout(function() {
                            printUserData();
                            printPostSequence();
                            printAlbumSequence();
                            printMap();
                        }, 1000);
                    }
                    
                    // Handlers
                    $loadPostsBtn.on('click', function() {
                        printPostSequence(); 
                    });
                    
                    $loadAlbumsBtn.on('click', function() {
                        printAlbumSequence();
                    })
                    
                    // Main
                    // Basically the code fetches everything. First print has delay.
                    // Succeeding prints don't have delay as they are handled by button handlers.
                    fetchUserData();
                    fetchUserPosts();
                    fetchUserAlbums();
                    printAllWithTimeout();
                }
            });
        </script>
  </body>
</html>
